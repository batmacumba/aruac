<h1>index.js</h1>
<pre><code class="lang-js"><span class="keyword">var</span> Buffer = require(<span class="string">'buffer'</span>).Buffer

module.exports = <span class="function"><span class="keyword">function</span> <span class="params">(buf)</span> {</span>
	<span class="comment">// If the buffer is backed by a Uint8Array, a faster version will work</span>
	<span class="keyword">if</span> (buf <span class="keyword">instanceof</span> Uint8Array) {
		<span class="comment">// If the buffer isn't a subarray, return the underlying ArrayBuffer</span>
		<span class="keyword">if</span> (buf.byteOffset === <span class="number">0</span> &amp;&amp; buf.byteLength === buf.buffer.byteLength) {
			<span class="keyword">return</span> buf.buffer
		} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> buf.buffer.slice === <span class="string">'function'</span>) {
			<span class="comment">// Otherwise we need to get a proper copy</span>
			<span class="keyword">return</span> buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength)
		}
	}

	<span class="keyword">if</span> (Buffer.isBuffer(buf)) {
		<span class="comment">// This is the slow version that will work with any Buffer</span>
		<span class="comment">// implementation (even in old browsers)</span>
		<span class="keyword">var</span> arrayCopy = <span class="keyword">new</span> Uint8Array(buf.length)
		<span class="keyword">var</span> len = buf.length
		<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) {
			arrayCopy[i] = buf[i]
		}
		<span class="keyword">return</span> arrayCopy.buffer
	} <span class="keyword">else</span> {
		<span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Argument must be a Buffer'</span>)
	}
}
</code></pre>